# 서류 제출 플로우 구현 가이드

## 핵심 파일

| 파일 | 설명 |
|------|------|
| `lib/auth/submitter-auth.ts` | 제출자 인증 유틸리티 |
| `app/submit/[documentBoxId]/[submitterId]/page.tsx` | 랜딩 페이지 |
| `app/submit/[documentBoxId]/[submitterId]/upload/page.tsx` | 업로드 페이지 |
| `app/submit/[documentBoxId]/[submitterId]/complete/page.tsx` | 완료 페이지 |

---

## 인증 유틸리티 사용법

```typescript
import { validateSubmitterAuth } from '@/lib/auth/submitter-auth';

const result = await validateSubmitterAuth(documentBoxId, submitterId);

// result.status 값:
// - 'success': 인증 완료
// - 'not_authenticated': 미로그인
// - 'email_mismatch': 이메일 불일치
// - 'not_found': 문서함/제출자 없음
// - 'expired': 만료됨
```

**반환 타입 (`SubmitterWithDocumentBox`)**:
- `submitter.*` - 제출자 정보
- `submitter.documentBox.*` - 문서함 정보
- `submitter.documentBox.requiredDocuments[]` - 필수 서류 목록
- `submitter.submittedDocuments[]` - 제출된 서류 목록

---

## OAuth 리다이렉트

Stack Auth의 `signInWithOAuth`는 `returnTo` 파라미터 사용:

```typescript
// 올바른 사용법
app.signInWithOAuth('google', {
  returnTo: '/submit/xxx/yyy/upload',
});

// 잘못된 사용법 (오류 발생)
app.signInWithOAuth('google', {
  afterCallbackRedirectUrl: '...',  // X
});
```

---

## Prisma 스키마 참고

```prisma
model Submitter {
  // 인증 관련 필드
  userId        String?         // Stack Auth 사용자 ID
  status        SubmitterStatus @default(PENDING)
  submittedAt   DateTime?

  @@index([userId])
  @@index([email])
}

enum SubmitterStatus {
  PENDING
  SUBMITTED
}
```

---

## 페이지별 리다이렉트 로직

| 페이지 | 조건 | 동작 |
|--------|------|------|
| 랜딩 | 이메일 일치 | → `/upload` |
| 업로드 | 미로그인/이메일 불일치 | → 랜딩 |
| 업로드 | 이미 제출 완료 | → `/complete` |
| 완료 | 미제출 상태 | → `/upload` |
